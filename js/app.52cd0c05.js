(function(e){function t(t){for(var i,s,o=t[0],c=t[1],l=t[2],h=0,d=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(d.length)d.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(i=!1)}i&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},r={app:0},a=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"11a5":function(e,t,n){},"13e4":function(e,t,n){"use strict";n("7d9e")},"56d7":function(e,t,n){"use strict";n.r(t);var i=n("2b0e"),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},a=[],s={name:"App",mounted(){}},o=s,c=(n("13e4"),n("2877")),l=Object(c["a"])(o,r,a,!1,null,null,null),u=l.exports,h=n("8c4f"),d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login flex"},[t("div",{staticClass:"main"},[e._m(0),t("van-form",[t("van-field",{attrs:{name:"用户名",label:"用户名",placeholder:"用户名",rules:[{required:!1,message:"请填写用户名"}]},model:{value:e.userName,callback:function(t){e.userName="string"===typeof t?t.trim():t},expression:"userName"}}),t("van-field",{attrs:{name:"房间号",label:"房间号",placeholder:"房间号",rules:[{required:!0,message:"请填写房间号"}]},model:{value:e.channelId,callback:function(t){e.channelId="string"===typeof t?t.trim():t},expression:"channelId"}}),t("div",{staticStyle:{margin:"16px"}},[t("van-button",{attrs:{type:"info",block:"",disabled:""===e.channelId||!e.isSupportRtc},on:{click:e.handleClickJoinBtn}},[e._v("进入房间")])],1)],1)],1)])},f=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"main-title"},[t("span",[e._v("音视频通信")])])}],p=(n("e7e5"),n("d399"));function m(e,t){return t>>>e|t<<32-e}function b(e,t,n){return e&t^~e&n}function v(e,t,n){return e&t^e&n^t&n}function g(e){return m(2,e)^m(13,e)^m(22,e)}function x(e){return m(6,e)^m(11,e)^m(25,e)}function C(e){return m(7,e)^m(18,e)^e>>>3}function y(e){return m(17,e)^m(19,e)^e>>>10}function I(e,t){return e[15&t]+=y(e[t+14&15])+e[t+9&15]+C(e[t+1&15])}var _,k,A,w=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),O="0123456789abcdef";function $(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function R(){_=new Array(8),k=new Array(2),A=new Array(64),k[0]=k[1]=0,_[0]=1779033703,_[1]=3144134277,_[2]=1013904242,_[3]=2773480762,_[4]=1359893119,_[5]=2600822924,_[6]=528734635,_[7]=1541459225}function W(){var e,t,n,i,r,a,s,o,c,l,u=new Array(16);e=_[0],t=_[1],n=_[2],i=_[3],r=_[4],a=_[5],s=_[6],o=_[7];for(var h=0;h<16;h++)u[h]=A[3+(h<<2)]|A[2+(h<<2)]<<8|A[1+(h<<2)]<<16|A[h<<2]<<24;for(var d=0;d<64;d++)c=o+x(r)+b(r,a,s)+w[d],c+=d<16?u[d]:I(u,d),l=g(e)+v(e,t,n),o=s,s=a,a=r,r=$(i,c),i=n,n=t,t=e,e=$(c,l);_[0]+=e,_[1]+=t,_[2]+=n,_[3]+=i,_[4]+=r,_[5]+=a,_[6]+=s,_[7]+=o}function P(e,t){var n,i,r=0;i=k[0]>>3&63;var a=63&t;for((k[0]+=t<<3)<t<<3&&k[1]++,k[1]+=t>>29,n=0;n+63<t;n+=64){for(var s=i;s<64;s++)A[s]=e.charCodeAt(r++);W(),i=0}for(s=0;s<a;s++)A[s]=e.charCodeAt(r++)}function S(){var e=k[0]>>3&63;if(A[e++]=128,e<=56)for(var t=e;t<56;t++)A[t]=0;else{for(t=e;t<64;t++)A[t]=0;W();for(t=0;t<56;t++)A[t]=0}A[56]=k[1]>>>24&255,A[57]=k[1]>>>16&255,A[58]=k[1]>>>8&255,A[59]=255&k[1],A[60]=k[0]>>>24&255,A[61]=k[0]>>>16&255,A[62]=k[0]>>>8&255,A[63]=255&k[0],W()}function j(){for(var e=new String,t=0;t<8;t++)for(var n=28;n>=0;n-=4)e+=O.charAt(_[t]>>>n&15);return e}function N(e){return R(),P(e,e.length),S(),j()}var B={name:"Login",data(){return{isSupportRtc:!1,userName:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5),channelId:"",userId:""}},methods:{handleClickJoinBtn(){p["a"].loading({message:"加入房间...",forbidClick:!0});const e=this.getAuthInfo();this.joinChannel(e)},joinChannel(e){this.$aliWebrtc.joinChannel(e,this.userName).then(()=>{p["a"].success("加入房间成功!"),this.$router.push({path:"/metting",query:{channelId:this.channelId,userName:this.userName,userId:this.userId}})},e=>{p["a"].fail("加入房间失败: "+e.message)})},getAuthInfo(){const e="hil6ydzc",t="8172773aeb6531f8fb9efd5162e6a08c",n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}));this.userId=n;const i=parseInt((new Date).getTime()/1e3+172800),r="AK-"+i,a=N(e+t+this.channelId+n+r+i);return{appid:e,userid:n,timestamp:i,nonce:r,token:a,gslb:["https://rgslb.rtc.aliyuncs.com"],channel:this.channelId}},checkSupportRtc(){this.$aliWebrtc.isSupport().then(e=>{console.log(e),this.isSupportRtc=!0}).catch(e=>{alert("support err: "+e.message),this.isSupportRtc=!1})}},created(){this.checkSupportRtc()}},V=B,J=(n("b0b3"),Object(c["a"])(V,d,f,!1,null,"3c1bc67b",null)),L=J.exports,M=function(){var e=this,t=e._self._c;return t("div",{staticClass:"metting flex"},[e._m(0),t("div",{staticClass:"local-container"},[t("div",{staticClass:"local-message"},[t("p",[e._v(" 用户名: "),t("strong",[e._v(e._s(e.userName))])]),t("p",[e._v(" 房间号: "),t("strong",[e._v(e._s(e.channelId))])])]),t("div",{staticClass:"local-video"},[e.isOpenCamera?t("video",{ref:"localVideo",attrs:{autoplay:""}}):t("van-empty",{staticClass:"custom-image",attrs:{image:"https://img01.yzcdn.cn/vant/custom-empty-image.png",description:"摄像头已关闭"}}),t("div",{staticClass:"btn-group"},[t("van-icon",{attrs:{name:"photograph",color:e.isOpenCamera?"#fff":"#666",size:"30px"},on:{click:e.handleClickCameraBtn}}),t("br"),t("van-icon",{attrs:{name:"volume",color:e.isOpenAudio?"#fff":"#666",size:"30px"},on:{click:e.handleClickAudioBtn}})],1),t("div",{staticClass:"btn-leave"},[t("van-icon",{attrs:{name:"phone-circle",color:"red",size:"50px"},on:{click:e.handleClickLeaveBtn}})],1)],1)]),t("div",{staticClass:"remote-container"},[t("h2",[e._v("房间成员")]),t("ul",e._l(e.remotes,(function(n){return t("li",{key:n.userId},[t("video",{ref:"remote"+n.userId,refInFor:!0,attrs:{autoplay:""},domProps:{muted:n.muteAudioPlaying}}),t("div",{staticClass:"remote-name"},[e._v(e._s(n.displayName))]),t("button",{class:n.muteAudioPlaying?"":"active",attrs:{type:"button"},on:{click:function(t){return e.handleClickRemoteAudioBtn(n.userId,!n.muteAudioPlaying)}}},[e._v(" 静音 ")])])})),0)])])},z=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"sideBar"},[t("h2",{staticClass:"logo"},[t("a",{attrs:{href:"/"}})])])}],T={name:"Metting",data(){return{channelId:"",userName:"",userId:"",isOpenCamera:!1,isOpenAudio:!1,remotes:[]}},methods:{handleClickCameraBtn(){const{isOpenCamera:e,isOpenAudio:t}=this;p["a"].loading({message:e?"关闭摄像头...":"打开摄像头...",forbidClick:!0}),this.publishVideo(!e,t)},handleClickAudioBtn(){const{isOpenCamera:e,isOpenAudio:t}=this;p["a"].loading({message:e?"关闭麦克风...":"打开麦克风...",forbidClick:!0}),this.publishVideo(e,!t)},handleClickRemoteAudioBtn(e,t){this.$aliWebrtc.muteRemoteAudioPlaying(e,t)},handleClickLeaveBtn(){this.leaveChannel()},publishVideo(e,t){this.$aliWebrtc.configLocalAudioPublish=t,this.$aliWebrtc.configLocalCameraPublish=e,this.$aliWebrtc.publish().then(()=>{console.log("推流成功"),console.log(this.$aliWebrtc.getUserInfo(this.userId)),this.showLocalVideo(e,t)},e=>{console.log("推流失败"),p["a"].fail("publish err: "+e.message)})},initRemotes(){const e=this.$aliWebrtc.getUserList();this.remotes=e,e.map(e=>{this.subscribeRemote(e.userId)})},listenRemoteJoin(){this.$aliWebrtc.on("onJoin",e=>{this.remotes.push(e),this.subscribeRemote(e.userId)})},leaveChannel(){this.$aliWebrtc.leaveChannel().then(()=>{console.log("退出成功"),this.$router.replace({path:"/"}),location.reload()},e=>{alert("leaveChannel err: "+e.message)})},init(){this.$aliWebrtc.on("onJoin",e=>{this.remotes.push(e),this.subscribeRemote(e.userId)})},showLocalVideo(e,t){this.$aliWebrtc.startPreview(this.$refs.localVideo).then(()=>{p["a"].success("推流成功!"),this.isOpenCamera=e,this.isOpenAudio=t}).catch(e=>{p["a"].fail("startPreview err: "+e.message)})},subscribeRemote(e){this.$aliWebrtc.configRemoteCameraTrack(e,!0,!0),this.$aliWebrtc.configRemoteAudio(e,!0),this.$aliWebrtc.subscribe(e).then(e=>{console.log("订阅成功"),console.log(this.$aliWebrtc.getUserInfo(e)),this.$aliWebrtc.setDisplayRemoteVideo(e,this.$refs["remote"+e][0],1)},e=>{p["a"].fail("subscribe err: "+e.message)})}},created(){const{channelId:e,userName:t,userId:n}=this.$route.query;this.userName=t,this.userId=n,this.channelId=e},mounted(){this.publishVideo(!0,!0),this.initRemotes(),this.listenRemoteJoin()},beforeDestroy(){this.leaveChannel()}},q=T,D=(n("ada1"),Object(c["a"])(q,M,z,!1,null,"101df320",null)),U=D.exports,E=new h["a"]({routes:[{path:"/",component:L},{path:"/metting",component:U}]}),F=(n("d4f7"),n("91d5"),n("f0ca")),K=(n("c3a6"),n("ad06")),G=(n("be7f"),n("565f")),H=(n("38d5"),n("772a")),Q=(n("66b9"),n("b650"));i["a"].use(Q["a"]),i["a"].use(H["a"]),i["a"].use(G["a"]),i["a"].use(K["a"]),i["a"].use(F["a"]),i["a"].config.productionTip=!1,i["a"].use(h["a"]),new i["a"]({render:e=>e(u),router:E,beforeCreate(){i["a"].prototype.$aliWebrtc=new window.AliRtcEngine({autoPublish:!0,autoSubscribe:!0})}}).$mount("#app")},"7d9e":function(e,t,n){},ada1:function(e,t,n){"use strict";n("fc39")},b0b3:function(e,t,n){"use strict";n("11a5")},fc39:function(e,t,n){}});
//# sourceMappingURL=app.52cd0c05.js.map