(function(e){function t(t){for(var i,s,o=t[0],c=t[1],l=t[2],h=0,d=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},a={app:0},r=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"11a5":function(e,t,n){},"13e4":function(e,t,n){"use strict";n("7d9e")},"552f":function(e,t,n){},"555d":function(e,t,n){"use strict";n("552f")},"56d7":function(e,t,n){"use strict";n.r(t);var i=n("2b0e"),a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},r=[],s={name:"App",mounted(){}},o=s,c=(n("13e4"),n("2877")),l=Object(c["a"])(o,a,r,!1,null,null,null),u=l.exports,h=n("8c4f"),d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login flex"},[t("div",{staticClass:"main"},[e._m(0),t("van-form",[t("van-field",{attrs:{name:"用户名",label:"用户名",placeholder:"用户名",rules:[{required:!1,message:"请填写用户名"}]},model:{value:e.userName,callback:function(t){e.userName="string"===typeof t?t.trim():t},expression:"userName"}}),t("van-field",{attrs:{name:"房间号",label:"房间号",placeholder:"房间号",rules:[{required:!0,message:"请填写房间号"}]},model:{value:e.channelId,callback:function(t){e.channelId="string"===typeof t?t.trim():t},expression:"channelId"}}),t("div",{staticStyle:{margin:"16px"}},[t("van-button",{attrs:{type:"info",block:"",disabled:""===e.channelId||!e.isSupportRtc},on:{click:e.handleClickJoinBtn}},[e._v("进入房间")])],1)],1)],1)])},p=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"main-title"},[t("span",[e._v("音视频通信")])])}],f=(n("e7e5"),n("d399"));function m(e,t){return t>>>e|t<<32-e}function b(e,t,n){return e&t^~e&n}function v(e,t,n){return e&t^e&n^t&n}function g(e){return m(2,e)^m(13,e)^m(22,e)}function x(e){return m(6,e)^m(11,e)^m(25,e)}function C(e){return m(7,e)^m(18,e)^e>>>3}function y(e){return m(17,e)^m(19,e)^e>>>10}function w(e,t){return e[15&t]+=y(e[t+14&15])+e[t+9&15]+C(e[t+1&15])}var I,_,k,A=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),O="0123456789abcdef";function $(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function R(){I=new Array(8),_=new Array(2),k=new Array(64),_[0]=_[1]=0,I[0]=1779033703,I[1]=3144134277,I[2]=1013904242,I[3]=2773480762,I[4]=1359893119,I[5]=2600822924,I[6]=528734635,I[7]=1541459225}function P(){var e,t,n,i,a,r,s,o,c,l,u=new Array(16);e=I[0],t=I[1],n=I[2],i=I[3],a=I[4],r=I[5],s=I[6],o=I[7];for(var h=0;h<16;h++)u[h]=k[3+(h<<2)]|k[2+(h<<2)]<<8|k[1+(h<<2)]<<16|k[h<<2]<<24;for(var d=0;d<64;d++)c=o+x(a)+b(a,r,s)+A[d],c+=d<16?u[d]:w(u,d),l=g(e)+v(e,t,n),o=s,s=r,r=a,a=$(i,c),i=n,n=t,t=e,e=$(c,l);I[0]+=e,I[1]+=t,I[2]+=n,I[3]+=i,I[4]+=a,I[5]+=r,I[6]+=s,I[7]+=o}function S(e,t){var n,i,a=0;i=_[0]>>3&63;var r=63&t;for((_[0]+=t<<3)<t<<3&&_[1]++,_[1]+=t>>29,n=0;n+63<t;n+=64){for(var s=i;s<64;s++)k[s]=e.charCodeAt(a++);P(),i=0}for(s=0;s<r;s++)k[s]=e.charCodeAt(a++)}function W(){var e=_[0]>>3&63;if(k[e++]=128,e<=56)for(var t=e;t<56;t++)k[t]=0;else{for(t=e;t<64;t++)k[t]=0;P();for(t=0;t<56;t++)k[t]=0}k[56]=_[1]>>>24&255,k[57]=_[1]>>>16&255,k[58]=_[1]>>>8&255,k[59]=255&_[1],k[60]=_[0]>>>24&255,k[61]=_[0]>>>16&255,k[62]=_[0]>>>8&255,k[63]=255&_[0],P()}function j(){for(var e=new String,t=0;t<8;t++)for(var n=28;n>=0;n-=4)e+=O.charAt(I[t]>>>n&15);return e}function N(e){return R(),S(e,e.length),W(),j()}var B={name:"Login",data(){return{isSupportRtc:!1,userName:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5),channelId:"",userId:""}},methods:{handleClickJoinBtn(){f["a"].loading({message:"加入房间...",forbidClick:!0});const e=this.getAuthInfo();this.joinChannel(e)},joinChannel(e){this.$aliWebrtc.joinChannel(e,this.userName).then(()=>{f["a"].success("加入房间成功!"),this.$router.push({path:"/metting",query:{channelId:this.channelId,userName:this.userName,userId:this.userId}})},e=>{f["a"].fail("加入房间失败: "+e.message)})},getAuthInfo(){const e="hil6ydzc",t="8172773aeb6531f8fb9efd5162e6a08c",n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}));this.userId=n;const i=parseInt((new Date).getTime()/1e3+172800),a="AK-"+i,r=N(e+t+this.channelId+n+a+i);return{appid:e,userid:n,timestamp:i,nonce:a,token:r,gslb:["https://rgslb.rtc.aliyuncs.com"],channel:this.channelId}},checkSupportRtc(){this.$aliWebrtc.isSupport().then(e=>{console.log(e),this.isSupportRtc=!0}).catch(e=>{alert("support err: "+e.message),this.isSupportRtc=!1})}},created(){this.checkSupportRtc()}},V=B,L=(n("b0b3"),Object(c["a"])(V,d,p,!1,null,"3c1bc67b",null)),J=L.exports,M=function(){var e=this,t=e._self._c;return t("div",{staticClass:"metting flex"},[e._m(0),t("div",{staticClass:"local-container"},[t("div",{staticClass:"local-message"},[t("p",[e._v(" 用户名: "),t("strong",[e._v(e._s(e.userName))])]),t("p",[e._v(" 房间号: "),t("strong",[e._v(e._s(e.channelId))])])]),t("div",{staticClass:"local-video"},[t("video",{directives:[{name:"show",rawName:"v-show",value:e.isOpenCamera,expression:"isOpenCamera"}],ref:"localVideo",attrs:{autoplay:""}}),t("van-empty",{directives:[{name:"show",rawName:"v-show",value:!e.isOpenCamera,expression:"!isOpenCamera"}],staticClass:"custom-image",attrs:{image:"https://img01.yzcdn.cn/vant/custom-empty-image.png",description:"摄像头已关闭"}}),t("div",{staticClass:"btn-group"},[t("van-icon",{attrs:{name:"photograph",color:e.isOpenCamera?"#fff":"#666",size:"30px"},on:{click:e.handleClickCameraBtn}}),t("br"),t("van-icon",{attrs:{name:"volume",color:e.isOpenAudio?"#fff":"#666",size:"30px"},on:{click:e.handleClickAudioBtn}})],1),t("div",{staticClass:"btn-leave"},[t("van-icon",{attrs:{name:"phone-circle",color:"red",size:"50px"},on:{click:e.handleClickLeaveBtn}})],1)],1)]),t("div",{staticClass:"remote-container"},[t("h2",[e._v("房间成员")]),t("ul",e._l(e.remotes,(function(n){return t("li",{key:n.userId},[t("video",{ref:"remote"+n.userId,refInFor:!0,attrs:{autoplay:""},domProps:{muted:n.muteAudioPlaying}}),t("div",{staticClass:"remote-name"},[e._v(e._s(n.displayName))]),t("button",{class:n.muteAudioPlaying?"":"active",attrs:{type:"button"},on:{click:function(t){return e.handleClickRemoteAudioBtn(n.userId,!n.muteAudioPlaying)}}},[e._v(" 静音 ")])])})),0)])])},z=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"sideBar"},[t("h2",{staticClass:"logo"},[t("a",{attrs:{href:"/"}})])])}],T={name:"Metting",data(){return{channelId:"",userName:"",userId:"",isOpenCamera:!1,isOpenAudio:!1,remotes:[]}},methods:{handleClickCameraBtn(){const{isOpenCamera:e,isOpenAudio:t}=this;f["a"].loading({message:e?"关闭摄像头...":"打开摄像头...",forbidClick:!0}),this.publishVideo(!e,t,e?"摄像头已关闭":"摄像头已打开")},handleClickAudioBtn(){const{isOpenCamera:e,isOpenAudio:t}=this;f["a"].loading({message:t?"关闭麦克风...":"打开麦克风...",forbidClick:!0}),this.publishVideo(e,!t,t?"麦克风已关闭":"麦克风已打开")},handleClickRemoteAudioBtn(e,t){this.$aliWebrtc.muteRemoteAudioPlaying(e,t)},handleClickLeaveBtn(){this.leaveChannel()},initLocalVideo(){this.publishVideo(!0,!0)},initRemotes(){const e=this.$aliWebrtc.getUserList();this.remotes=e,e.map(e=>{this.subscribeRemote(e.userId)})},listenRemoteJoin(){this.$aliWebrtc.on("onJoin",e=>{this.remotes.push(e),this.subscribeRemote(e.userId)})},publishVideo(e,t,n=""){this.$aliWebrtc.configLocalAudioPublish=t,this.$aliWebrtc.configLocalCameraPublish=e,this.$aliWebrtc.publish().then(()=>{n&&f["a"].success(n),this.isOpenCamera=e,this.isOpenAudio=t,this.showLocalVideo()},e=>{f["a"].fail("publish err: "+e.message)})},leaveChannel(){this.$aliWebrtc.leaveChannel().then(()=>{f["a"].success("退出成功"),this.$router.replace({path:"/"}),location.reload()},e=>{f["a"].fail("leaveChannel err: "+e.message)})},init(){this.$aliWebrtc.on("onJoin",e=>{this.remotes.push(e),this.subscribeRemote(e.userId)})},showLocalVideo(){this.$aliWebrtc.startPreview(this.$refs.localVideo).then(()=>{}).catch(e=>{f["a"].fail("startPreview err: "+e.message)})},subscribeRemote(e){this.$aliWebrtc.configRemoteCameraTrack(e,!0,!0),this.$aliWebrtc.configRemoteAudio(e,!0),this.$aliWebrtc.subscribe(e).then(e=>{console.log("订阅成功"),console.log(this.$aliWebrtc.getUserInfo(e)),this.$aliWebrtc.setDisplayRemoteVideo(e,this.$refs["remote"+e][0],1)},e=>{f["a"].fail("subscribe err: "+e.message)})}},created(){const{channelId:e,userName:t,userId:n}=this.$route.query;this.userName=t,this.userId=n,this.channelId=e},mounted(){this.initLocalVideo(),this.initRemotes()},beforeDestroy(){this.leaveChannel()}},q=T,D=(n("555d"),Object(c["a"])(q,M,z,!1,null,"23bfc340",null)),U=D.exports,E=new h["a"]({routes:[{path:"/",component:J},{path:"/metting",component:U}]}),F=(n("d4f7"),n("91d5"),n("f0ca")),K=(n("c3a6"),n("ad06")),G=(n("be7f"),n("565f")),H=(n("38d5"),n("772a")),Q=(n("66b9"),n("b650"));i["a"].use(Q["a"]),i["a"].use(H["a"]),i["a"].use(G["a"]),i["a"].use(K["a"]),i["a"].use(F["a"]),i["a"].config.productionTip=!1,i["a"].use(h["a"]),new i["a"]({render:e=>e(u),router:E,beforeCreate(){i["a"].prototype.$aliWebrtc=new window.AliRtcEngine({autoPublish:!0,autoSubscribe:!0})}}).$mount("#app")},"7d9e":function(e,t,n){},b0b3:function(e,t,n){"use strict";n("11a5")}});
//# sourceMappingURL=app.478b53b3.js.map