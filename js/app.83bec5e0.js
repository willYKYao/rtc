(function(e){function t(t){for(var n,r,o=t[0],c=t[1],l=t[2],d=0,h=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&h.push(a[r][0]),a[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(h.length)h.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],n=!0,o=1;o<i.length;o++){var c=i[o];0!==a[c]&&(n=!1)}n&&(s.splice(t--,1),e=r(r.s=i[0]))}return e}var n={},a={app:0},s=[];function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;s.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"13e4":function(e,t,i){"use strict";i("7d9e")},"1f02":function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);var n=i("2b0e"),a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},s=[],r={name:"App",mounted(){}},o=r,c=(i("13e4"),i("2877")),l=Object(c["a"])(o,a,s,!1,null,null,null),u=l.exports,d=i("8c4f"),h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login flex"},[t("div",{staticClass:"main"},[e._m(0),t("van-form",[t("van-field",{attrs:{name:"用户名",label:"用户名",placeholder:"用户名",rules:[{required:!1,message:"请填写用户名"}]},model:{value:e.userName,callback:function(t){e.userName="string"===typeof t?t.trim():t},expression:"userName"}}),t("van-field",{attrs:{name:"房间号",label:"房间号",placeholder:"房间号",rules:[{required:!0,message:"请填写房间号"}]},model:{value:e.channelId,callback:function(t){e.channelId="string"===typeof t?t.trim():t},expression:"channelId"}}),t("div",{staticStyle:{margin:"16px"}},[t("van-button",{attrs:{type:"info",block:"",disabled:""===e.channelId||!e.isSupportRtc},on:{click:e.handleClickJoinBtn}},[e._v("进入房间")])],1)],1)],1)])},p=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"main-title"},[t("span",[e._v("音视频通信")])])}],m=(i("e7e5"),i("d399"));function f(e,t){return t>>>e|t<<32-e}function v(e,t,i){return e&t^~e&i}function b(e,t,i){return e&t^e&i^t&i}function g(e){return f(2,e)^f(13,e)^f(22,e)}function y(e){return f(6,e)^f(11,e)^f(25,e)}function x(e){return f(7,e)^f(18,e)^e>>>3}function C(e){return f(17,e)^f(19,e)^e>>>10}function I(e,t){return e[15&t]+=C(e[t+14&15])+e[t+9&15]+x(e[t+1&15])}var w,k,_,A=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),O="0123456789abcdef";function R(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i}function $(){w=new Array(8),k=new Array(2),_=new Array(64),k[0]=k[1]=0,w[0]=1779033703,w[1]=3144134277,w[2]=1013904242,w[3]=2773480762,w[4]=1359893119,w[5]=2600822924,w[6]=528734635,w[7]=1541459225}function D(){var e,t,i,n,a,s,r,o,c,l,u=new Array(16);e=w[0],t=w[1],i=w[2],n=w[3],a=w[4],s=w[5],r=w[6],o=w[7];for(var d=0;d<16;d++)u[d]=_[3+(d<<2)]|_[2+(d<<2)]<<8|_[1+(d<<2)]<<16|_[d<<2]<<24;for(var h=0;h<64;h++)c=o+y(a)+v(a,s,r)+A[h],c+=h<16?u[h]:I(u,h),l=g(e)+b(e,t,i),o=r,r=s,s=a,a=R(n,c),n=i,i=t,t=e,e=R(c,l);w[0]+=e,w[1]+=t,w[2]+=i,w[3]+=n,w[4]+=a,w[5]+=s,w[6]+=r,w[7]+=o}function P(e,t){var i,n,a=0;n=k[0]>>3&63;var s=63&t;for((k[0]+=t<<3)<t<<3&&k[1]++,k[1]+=t>>29,i=0;i+63<t;i+=64){for(var r=n;r<64;r++)_[r]=e.charCodeAt(a++);D(),n=0}for(r=0;r<s;r++)_[r]=e.charCodeAt(a++)}function W(){var e=k[0]>>3&63;if(_[e++]=128,e<=56)for(var t=e;t<56;t++)_[t]=0;else{for(t=e;t<64;t++)_[t]=0;D();for(t=0;t<56;t++)_[t]=0}_[56]=k[1]>>>24&255,_[57]=k[1]>>>16&255,_[58]=k[1]>>>8&255,_[59]=255&k[1],_[60]=k[0]>>>24&255,_[61]=k[0]>>>16&255,_[62]=k[0]>>>8&255,_[63]=255&k[0],D()}function S(){for(var e=new String,t=0;t<8;t++)for(var i=28;i>=0;i-=4)e+=O.charAt(w[t]>>>i&15);return e}function j(e){return $(),P(e,e.length),W(),S()}var N={name:"Login",data(){return{isSupportRtc:!1,userName:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5),channelId:"",userId:"",audioDevice:!1,videoDevice:!1}},methods:{async handleClickJoinBtn(){m["a"].loading({message:"加入房间...",forbidClick:!0});const e=await this.getAuthInfo();this.joinChannel(e)},checkSupportRtc(){this.$aliWebrtc.isSupport().then(e=>{this.isSupportRtc=!0,this.videoDevice=e.videoDevice,this.audioDevice=e.audioDevice}).catch(e=>{m["a"].fail("support err: "+e.message),this.isSupportRtc=!1})},joinChannel(e){this.$aliWebrtc.joinChannel(e,this.userName).then(()=>{m["a"].success("加入房间!");const{channelId:e,userName:t,userId:i,audioDevice:n,videoDevice:a}=this;this.$router.push({name:"metting",params:{channelId:e,userName:t,userId:i,audioDevice:n,videoDevice:a}})},e=>{m["a"].fail("加入房间失败: "+e.message)})},async getAuthInfo(){const e="hil6ydzc",t="8172773aeb6531f8fb9efd5162e6a08c",i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)}));this.userId=i;const n=parseInt((new Date).getTime()/1e3+172800),a="AK-"+n,s=await this.getToken({appId:e,key:t,channelId:this.channelId,userId:i,nonce:a,timestamp:n});return{appid:e,userid:i,timestamp:n,nonce:a,token:s,gslb:["https://rgslb.rtc.aliyuncs.com"],channel:this.channelId}},getToken({appId:e,key:t,channelId:i,userId:n,nonce:a,timestamp:s}){return new Promise(r=>{setTimeout(()=>{let o=j(e+t+i+n+a+s);r(o)},1e3)})}},created(){this.checkSupportRtc()}},L=N,B=(i("ccc6"),Object(c["a"])(L,h,p,!1,null,"26e9debc",null)),V=B.exports,T=function(){var e=this,t=e._self._c;return t("div",{staticClass:"metting flex"},[e._m(0),t("div",{staticClass:"local-container"},[t("div",{staticClass:"local-message"},[t("p",[e._v(" 用户名: "),t("strong",[e._v(e._s(e.userName))])]),t("p",[e._v(" 房间号: "),t("strong",[e._v(e._s(e.channelId))])])]),t("div",{staticClass:"local-video"},[t("video",{directives:[{name:"show",rawName:"v-show",value:e.isOpenCamera,expression:"isOpenCamera"}],ref:"localVideo",attrs:{autoplay:""}}),t("van-empty",{directives:[{name:"show",rawName:"v-show",value:!e.isOpenCamera,expression:"!isOpenCamera"}],staticClass:"custom-image",attrs:{image:"https://img01.yzcdn.cn/vant/custom-empty-image.png",description:"摄像头未开启"}}),t("div",{staticClass:"btn-group"},[e.videoDevice?t("van-icon",{attrs:{name:"photograph",color:e.isOpenCamera?"#fff":"#666",size:"30px"},on:{click:e.handleClickCameraBtn}}):e._e(),t("br"),e.audioDevice?t("van-icon",{attrs:{name:"volume",color:e.isOpenAudio?"#fff":"#666",size:"30px"},on:{click:e.handleClickAudioBtn}}):e._e()],1),t("div",{staticClass:"btn-leave"},[t("van-icon",{attrs:{name:"phone-circle",color:"red",size:"50px"},on:{click:e.handleClickLeaveBtn}})],1)],1)]),t("div",{staticClass:"remote-container"},[t("h2",[e._v("房间成员")]),t("ul",e._l(e.remotes,(function(i){return t("li",{key:i.userId},[t("video",{ref:"remote"+i.userId,refInFor:!0,attrs:{autoplay:""},domProps:{muted:i.muteAudioPlaying}}),t("div",{staticClass:"remote-name"},[e._v(e._s(i.displayName))]),t("button",{class:i.muteAudioPlaying?"":"active",attrs:{type:"button"},on:{click:function(t){return e.handleClickRemoteAudioBtn(i.userId,!i.muteAudioPlaying)}}},[e._v(" 静音 ")])])})),0)])])},J=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"sideBar"},[t("h2",{staticClass:"logo"},[t("a",{attrs:{href:"/"}})])])}],M={name:"Metting",data(){return{isOpenCamera:!1,isOpenAudio:!1,remotes:[]}},props:["channelId","userName","userId","audioDevice","videoDevice"],methods:{handleClickCameraBtn(){const{isOpenCamera:e,isOpenAudio:t}=this;m["a"].loading({message:e?"关闭摄像头...":"打开摄像头...",forbidClick:!0}),this.publishVideo(!e,t,e?"摄像头已关闭":"摄像头已打开")},handleClickAudioBtn(){const{isOpenCamera:e,isOpenAudio:t}=this;m["a"].loading({message:t?"关闭麦克风...":"打开麦克风...",forbidClick:!0}),this.publishVideo(e,!t,t?"麦克风已关闭":"麦克风已打开")},handleClickLeaveBtn(){this.leaveChannel()},handleClickRemoteAudioBtn(e,t){this.$aliWebrtc.muteRemoteAudioPlaying(e,t),this.remotes.map((t,i)=>{t.userId===e&&this.remotes.splice(i,1,this.$aliWebrtc.getUserInfo(e))})},initLocalVideo(){const{audioDevice:e,videoDevice:t}=this;(e||t)&&this.publishVideo(t,e)},initRemotes(){const e=this.$aliWebrtc.getUserList();this.remotes=e,e.map(e=>{this.subscribeRemote(e.userId)})},listenRemoteJoin(){this.$aliWebrtc.on("onJoin",e=>{this.remotes.push(e),this.subscribeRemote(e.userId),m["a"].success(e.displayName+"进入房间")})},listenRemotePublish(){this.$aliWebrtc.on("onPublisher",e=>{this.subscribeRemote(e.userId)})},listenRemoteLeave(){this.$aliWebrtc.on("onLeave",e=>{this.remotes.map((t,i)=>{t.userId===e.userId&&this.remotes.splice(i,1)}),m["a"].success(e.displayName+"离开房间")})},publishVideo(e,t,i=""){this.$aliWebrtc.configLocalAudioPublish=t,this.$aliWebrtc.configLocalCameraPublish=e,this.$aliWebrtc.publish().then(()=>{i&&m["a"].success(i),this.isOpenCamera=e,this.isOpenAudio=t,this.showLocalVideo()},e=>{m["a"].fail("publish err: "+e.message)})},showLocalVideo(){this.$aliWebrtc.startPreview(this.$refs.localVideo).then(()=>{}).catch(e=>{m["a"].fail("startPreview err: "+e.message)})},leaveChannel(){this.$aliWebrtc.leaveChannel().then(()=>{m["a"].success("退出房间"),this.$router.replace({path:"/"}),location.reload()},e=>{m["a"].fail("leaveChannel err: "+e.message)})},subscribeRemote(e){this.$aliWebrtc.configRemoteCameraTrack(e,!0,!0),this.$aliWebrtc.configRemoteAudio(e,!0),this.$aliWebrtc.subscribe(e).then(e=>{this.$aliWebrtc.setDisplayRemoteVideo(e,this.$refs["remote"+e][0],1),this.remotes.map((t,i)=>{t.userId===e&&this.remotes.splice(i,1,this.$aliWebrtc.getUserInfo(e))})},e=>{m["a"].fail("subscribe err: "+e.message)})}},mounted(){this.initLocalVideo(),this.initRemotes(),this.listenRemoteJoin(),this.listenRemotePublish(),this.listenRemoteLeave()},beforeDestroy(){this.leaveChannel()}},z=M,q=(i("9117"),Object(c["a"])(z,T,J,!1,null,"61d41adf",null)),U=q.exports,E=new d["a"]({routes:[{path:"/",component:V},{name:"metting",path:"/metting/:channelId/:userName/:userId/:audioDevice/:videoDevice",component:U,props(e){return{...e.params,...e.query}}}]}),F=(i("d4f7"),i("91d5"),i("f0ca")),K=(i("c3a6"),i("ad06")),G=(i("be7f"),i("565f")),H=(i("38d5"),i("772a")),Q=(i("66b9"),i("b650"));n["a"].use(Q["a"]),n["a"].use(H["a"]),n["a"].use(G["a"]),n["a"].use(K["a"]),n["a"].use(F["a"]),n["a"].config.productionTip=!1,n["a"].use(d["a"]),new n["a"]({render:e=>e(u),router:E,beforeCreate(){n["a"].prototype.$aliWebrtc=new window.AliRtcEngine({autoPublish:!0,autoSubscribe:!0})}}).$mount("#app")},"6f00":function(e,t,i){},"7d9e":function(e,t,i){},9117:function(e,t,i){"use strict";i("1f02")},ccc6:function(e,t,i){"use strict";i("6f00")}});
//# sourceMappingURL=app.83bec5e0.js.map